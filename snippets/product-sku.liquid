<p id="variant-sku">SKU: {{ product.variants.first.sku }}</p>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const skuDisplay = document.getElementById('variant-sku');
    const productData = {{ product | json }};

    function updateSkuById(variantId) {
      const id = Number(variantId); // Ensure it's a number
      const matchedVariant = productData.variants.find(v => v.id === id);
      if (matchedVariant) {
        skuDisplay.textContent = matchedVariant.sku ? 'SKU: ' + matchedVariant.sku : 'SKU: N/A';

        // Update hidden input if needed
        const variantIdInput = document.querySelector('[name="id"]');
        if (variantIdInput) variantIdInput.value = matchedVariant.id;
      }
    }

    function getVariantFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('variant');
    }

    // On load: handle variant from URL
    const variantFromUrl = getVariantFromUrl();
    if (variantFromUrl) {
      const input = document.querySelector(`.custom-variant__inputs[value="${variantFromUrl}"]`);
      if (input) {
        input.checked = true;
        input.dispatchEvent(new Event('change'));
      } else {
        updateSkuById(variantFromUrl); // fallback
      }
    } else {
      // Default to currently selected variant
      const checkedInput = document.querySelector('.custom-variant__inputs:checked');
      if (checkedInput) updateSkuById(checkedInput.value);
    }

    // Watch for any variant input change
    document.querySelectorAll('.custom-variant__inputs').forEach(input => {
      input.addEventListener('change', function () {
        updateSkuById(this.value);
      });
    });
  });
</script>
