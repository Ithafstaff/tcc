<p id="variant-sku">SKU: {{ product.variants.first.sku }}</p>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const skuDisplay = document.getElementById('variant-sku');
    const productData = {{ product | json }};
    let lastVariantId = null;

    function getVariantIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('variant');
    }

    function updateSkuByVariantId(variantId) {
      const variant = productData.variants.find(v => v.id == variantId);
      if (variant) {
        skuDisplay.textContent = variant.sku ? 'SKU: ' + variant.sku : 'SKU: N/A';
      }
    }

    function detectVariantChange() {
      const currentId = getVariantIdFromUrl();
      if (currentId && currentId !== lastVariantId) {
        lastVariantId = currentId;
        updateSkuByVariantId(currentId);
      }
    }

    // Initial run
    detectVariantChange();

    // Keep checking every 300ms (variant change via JS doesnâ€™t trigger full page reload)
    setInterval(detectVariantChange, 300);
  });
</script>
